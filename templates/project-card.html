<template id="project-card-template">
  <style>
    :host {
			display: block;
			background: #ffffff;
			border-radius: 12px;
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
			padding: 25px;
			width: calc(33% - 25px);
			box-sizing: border-box;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			transition: transform 0.3s ease, box-shadow 0.3s ease;
		}

		:host(:hover) {
			transform: translateY(-8px);
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
		}

		h2 {
			margin-top: 0;
			margin-bottom: 10px;
			font-size: 1.6em;
			color: #34495e;
		}

		h2 a {
			text-decoration: none;
			color: #007bff;
			transition: color 0.2s ease;
		}

		h2 a:hover {
			color: #0056b3;
		}

		.tagline {
			font-style: italic;
			color: #7f8c8d;
			margin-bottom: 15px;
			font-size: 0.95em;
		}

		.team-avatars {
			display: flex;
			align-items: center;
			flex-wrap: wrap;
			margin-top: 15px;
			margin-bottom: 15px;
		}

		.likes {
			font-weight: bold;
			color: #e74c3c;
			font-size: 1.1em;
			display: flex;
			align-items: center;
			justify-content: flex-end;
			margin-top: auto;
		}

		.likes::before {
			content: '‚ù§Ô∏è';
			margin-right: 5px;
		}

		.description {
			margin-bottom: 15px;
			color: #555;
			font-size: 0.9em;
			line-height: 1.5;
		}

		.tags {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			margin-top: 10px;
			margin-bottom: 15px;
		}

		.cp-tag {
			background-color: #e0e0e0;
			color: #333;
			padding: 5px 10px;
			border-radius: 5px;
			font-size: 0.8em;
		}
  </style>
  <h2>
    <a href="">
      <slot name="title"></slot>
    </a>
    <span class="winner"></span>
  </h2>
  <p class="tagline">
    <slot name="tagline"></slot>
  </p>
  <div class="team-avatars"></div>
  <p class="description">
    <slot name="description"></slot>
  </p>
  <div class="tags"></div>
  <div class="likes">
    <slot name="likes"></slot>
  </div>
</template>
<script>
  'use strict';
	class ProjectCard extends HTMLElement {
		constructor() {
			super();
			this.attachShadow({mode: 'open'});
			const template = document.getElementById('project-card-template').content;
			this.shadowRoot.appendChild(template.cloneNode(true));
		}

		static get observedAttributes() {
			return ['url', 'title', 'winner', 'tagline', 'likes', 'team', 'description', 'tags'];
		}

		connectedCallback() {
			this._render();
		}

		attributeChangedCallback(name, oldValue, newValue) {
			if (oldValue !== newValue) {
				this._render();
			}
		}

		_render() {
			this.shadowRoot.querySelector('h2 a').href = this.getAttribute('url') || '';
			this.shadowRoot.querySelector('slot[name="title"]').innerHTML = this.getAttribute('title') || '';
			const winnerSpan = this.shadowRoot.querySelector('.winner');
			if (this.hasAttribute('winner')) {
				winnerSpan.textContent = ' üèÜ';
			} else {
				winnerSpan.textContent = '';
			}
			this.shadowRoot.querySelector('slot[name="tagline"]').innerHTML = this.getAttribute('tagline') || '';
			this.shadowRoot.querySelector('slot[name="likes"]').innerHTML = this.getAttribute('likes') || '';

			const avatarsContainer = this.shadowRoot.querySelector('.team-avatars');
			avatarsContainer.innerHTML = ''; // Clear existing avatars
			try {
				const team = JSON.parse(this.getAttribute('team') || '[]');
				team.forEach(member => {
					const teamMember = document.createElement('team-member');
					teamMember.setAttribute('avatar-url', member.AvatarURL);
					teamMember.setAttribute('member-name', member.Name);
					teamMember.setAttribute('member-url', member.URL);
					avatarsContainer.appendChild(teamMember);
				});
			} catch (e) {
				console.error('Error parsing team attribute:', e);
			}

			// TODO:
			// this.shadowRoot.querySelector('slot[name="description"]').innerHTML = this.getAttribute('description') || '';

			const tagsContainer = this.shadowRoot.querySelector('.tags');
			tagsContainer.innerHTML = ''; // Clear existing tags
			try {
				const tags = JSON.parse(this.getAttribute('tags') || '[]');
				tags.forEach(tag => {
					const tagSpan = document.createElement('span');
					tagSpan.textContent = tag;
					tagSpan.classList.add('cp-tag');
					tagsContainer.appendChild(tagSpan);
				});
			} catch (e) {
				console.error('Error parsing tags attribute:', e);
			}
		}
	}

	customElements.define('project-card', ProjectCard);
</script>
{{template "team-member.html" .}}
