{{/* This file will contain the shared code to update the data */}}
<script>
  'use strict';

	async function renderProjects(eventID) {
		const container = document.getElementById('projects-container');
		const existingCards = new Map(Array.from(container.children).map(card => [card.getAttribute('url'), card]));
		const projects = await fetchProjects(eventID);
		projects.forEach((project) => {
			let card = existingCards.get(project.url);
			if (!card) {
				card = document.createElement('project-card');
				card = container.appendChild(card);
			} else {
				existingCards.delete(project.url);
			}
			const raw = JSON.stringify(project);
			if (card.getAttribute('data-json') !== raw) {
				card.setAttribute('data-json', raw);
			}
		});
		// Remove old cards
		existingCards.forEach(card => card.remove());
	}

	window.addEventListener('load', async () => {
		const pathParts = window.location.pathname.split('/');
		const eventID = pathParts[pathParts.indexOf('event') + 1];
		if (eventID) {
			await renderProjects(eventID);
			setInterval(async () => {
				await renderProjects(eventID);
			}, 30000);
		}
	});
</script>
{{template "partial_api.html" .}}
